var App=angular.module("App",["ngSanitize","ngRoute","cartApp","productsApp","menu","miniBasket"]);App.config(["$locationProvider","$routeProvider",function(t,e){t.hashPrefix("!"),e.when("/cart",{templateUrl:"cart.html",controller:"cartController"}).when("/",{templateUrl:"products.html",controller:"productsController"}).otherwise({redirectTo:"/"})}]);var cartApp=angular.module("cartApp",["ngSanitize","productList","menu"]);cartApp.controller("cartController",["$scope","cartService",function(r,n){r.list=n.get(),r.remove=function(t){r.list=n.remove(t)},r.changeCount=function(t,e){r.list=n.changeCount(t,e)},r.$watch("list",function(){r.total=n.getTotalSumm()})}]),angular.module("productList",[]).directive("productList",function(){return{restrict:"E",scope:{list:"=",simple:"=",title:"=",addToCart:"=",remove:"=",changeCount:"="},templateUrl:"/templates/products-list.html",replace:!0}}),angular.module("miniBasket",[]).directive("miniBasket",function(){return{restrict:"E",scope:{total:"="},templateUrl:"/templates/mini-basket.html",replace:!0}}),angular.module("menu",["ngRoute"]).directive("menu",["$location",function(n){return{restrict:"E",scope:!0,templateUrl:"/templates/menu.html",replace:!0,link:function(r){var t=[{title:"Cart",href:"/cart",active:!1},{title:"Catalog",href:"/",active:!1}];r.currentUrl=n.path(),r.$on("$routeChangeStart",function(t,e){r.currentUrl=e.$$route.originalPath}),r.$watch("currentUrl",function(){r.list=t.map(function(t){return t.href===n.path()?t.active=!0:t.active=!1,t})}),r.to=function(t){t.preventDefault();var e=t.target.getAttribute("href");n.path(e)}}}}]);var productsApp=angular.module("productsApp",["ngSanitize","productList","miniBasket","menu"]);productsApp.controller("productsController",["$scope","productsService","cartService",function(e,t,r){e.list=t.get(),e.total=r.getTotalSumm(),e.addToCart=function(t){r.add(t),e.total=r.getTotalSumm()}}]),App.factory("productsService",function(){return{get:function(){return[{id:1,name:"Product 1",price:100},{id:2,name:"Product 2",price:150}]}}}),App.factory("cartService",function(){var t="cart__",o=localStorage.getItem(t)?JSON.parse(localStorage.getItem(t)):[];function c(e){var t=o.filter(function(t){return t.id===e});return 0<t.length?t[0]:null}function i(e){return o=o.filter(function(t){return t.id!=e}),a(),o.slice()}function a(){localStorage.setItem(t,JSON.stringify(o))}return{get:function(){return o.slice()},add:function(t){var e=c(t.id);return e?e.count+=1:(t.count=1,o.push(t)),a(),o.slice()},remove:i,getTotalSumm:function(){return o.reduce(function(t,e){return t+=e.price*e.count},0)},changeCount:function(t,e){var r=c(t),n=r.count+e;return n<1&&i(t),r.count=n,a(),o.slice()}}});