var App=angular.module("App",["ngSanitize","ngRoute","cartApp","productsApp"]);App.config(["$locationProvider","$routeProvider",function(t,e){t.hashPrefix("!"),e.when("/cart",{templateUrl:"cart.html",controller:"cartController"}).when("/",{templateUrl:"products.html",controller:"productsController"}).otherwise({redirectTo:"/"})}]);var cartApp=angular.module("cartApp",["ngSanitize","productList","menu"]);cartApp.controller("cartController",["$location","$scope","cartService",function(t,r,n){r.list=n.get(),r.total=n.getTotalSumm(),r.remove=function(t){r.list=n.remove(t),r.total=n.getTotalSumm()},r.changeCount=function(t,e){r.list=n.changeCount(t,e),r.total=n.getTotalSumm()}}]),angular.module("productList",[]).directive("productList",function(){return{restrict:"E",scope:{list:"=",simple:"=",title:"=",addToCart:"=",remove:"=",changeCount:"="},templateUrl:"/templates/products-list.html",replace:!0}}),angular.module("miniBasket",[]).directive("miniBasket",function(){return{restrict:"E",scope:{total:"="},templateUrl:"/templates/mini-basket.html",replace:!0}}),angular.module("menu",["ngRoute"]).directive("menu",["$location",function(r){return{restrict:"E",templateUrl:"/templates/menu.html",replace:!0,link:function(t){t.to=function(t){t.preventDefault();var e=t.target.getAttribute("href");r.path(e)}}}}]);var productsApp=angular.module("productsApp",["ngSanitize","productList","miniBasket","menu"]);productsApp.controller("productsController",["$location","$scope","productsService","cartService",function(t,e,r,n){e.list=r.get(),e.total=n.getTotalSumm(),e.addToCart=function(t){n.add(t),e.total=n.getTotalSumm()}}]),App.factory("productsService",function(){return{get:function(){return[{id:1,name:"Product 1",price:100},{id:2,name:"Product 2",price:150}]}}}),App.factory("cartService",function(){var t="cart__",o=localStorage.getItem(t)?JSON.parse(localStorage.getItem(t)):[];function c(e){var t=o.filter(function(t){return t.id===e});return 0<t.length?t[0]:null}function u(e){return o=o.filter(function(t){return t.id!=e}),i(),o.slice()}function i(){localStorage.setItem(t,JSON.stringify(o))}return{get:function(){return o.slice()},add:function(t){var e=c(t.id);return e?e.count+=1:(t.count=1,o.push(t)),i(),o.slice()},remove:u,getTotalSumm:function(){return o.reduce(function(t,e){return t+=e.price*e.count},0)},changeCount:function(t,e){var r=c(t),n=r.count+e;return n<1&&u(t),r.count=n,i(),o.slice()}}});